<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sewakuy</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>

<body style="background-color: #F1F1F6;">

<!-- ======================= NAVBAR ======================= -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm fixed-top"
     style="font-family: cursive; font-size: large; font-weight: bold;">

  <div class="container py-1">
    <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="assets/logo.png" style="height: 38px; margin-right: 8px;">
        Sewakuy
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">

      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="#home">Beranda</a></li>
        <li class="nav-item"><a class="nav-link" href="#category">Kategori</a></li>
        <li class="nav-item"><a class="nav-link" href="#about">Tentang</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">Kontak</a></li>
        <li class="nav-item"><a class="nav-link text-primary" href="seller.html">Seller View</a></li>
      </ul>
    </div>

  </div>
</nav>
<!-- ======================= END NAVBAR ======================= -->


<!-- ======================= HOME SECTION ======================= -->
<section id="home" style="margin-top: 70px;">
    <div class="container-fluid p-0">

        <video autoplay muted loop class="w-100" style="height: 100vh; object-fit: cover;">
            <source src="assets/Bg.mp4">
        </video>

        <div class="position-absolute top-50 start-50 translate-middle text-center" style="font-family: monospace;">
            <h1 class="fw-bold">Sewa Barang Jadi Mudah</h1>
            <p>Platform mahasiswa untuk mahasiswa</p>

            <div class="d-flex justify-content-center gap-3 mt-3">
                <button id="rentBtn" class="btn btn-secondary" style="width: 5cm;">Sewa Sekarang</button>
                <button id="addBtn" class="btn btn-secondary" style="width: 5cm;">Daftarkan Barangmu</button>
            </div>
        </div>
    </div>
</section>
<!-- ======================= END HOME ======================= -->


<!-- ======================= MODAL RENT ======================= -->
<div class="modal fade" id="rentModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="fw-bold">ðŸ“¦ Form Penyewaan Barang</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form id="rentForm">

          <h6 class="fw-bold">1. Data Peminjam</h6>
          <div class="mb-2"><input class="form-control" placeholder="Nama" required></div>
          <div class="mb-2"><input class="form-control" placeholder="NRP" required></div>
          <div class="mb-2"><input class="form-control" placeholder="Kontak (WA/Email)" required></div>

          <hr>
          <h6 class="fw-bold">2. Detail Penyewaan</h6>

          <div class="mb-2">
            <input type="text" id="namaBarangRent" class="form-control" placeholder="Nama Barang" required>
          </div>

          <div class="row">
            <div class="col-md-6 mb-2"><input type="date" class="form-control" required></div>
            <div class="col-md-6 mb-2"><input type="date" class="form-control" required></div>
          </div>

          <button class="btn btn-primary w-100 mt-2">Sewa Sekarang</button>

        </form>
      </div>

    </div>
  </div>
</div>


<!-- ======================= MODAL ADD ITEM ======================= -->
<div class="modal fade" id="addModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="fw-bold">ðŸ›’ Tambah Barang Sewa</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <form id="addForm">

          <h6 class="fw-bold">1. Identitas Mahasiswa</h6>
          <input id="mhsNama" class="form-control mb-2" placeholder="Nama" required>
          <input id="mhsNRP" class="form-control mb-2" placeholder="NRP" required>
          <input id="mhsProdi" class="form-control mb-2" placeholder="Program Studi" required>
          <input id="mhsKontak" class="form-control mb-2" placeholder="WA / Email Kampus" required>
          <input id="mhsKTM" type="file" class="form-control mb-3" accept="image/*" required>

          <hr>
          <h6 class="fw-bold">2. Informasi Barang</h6>

          <input id="barangNama" class="form-control mb-2" placeholder="Nama Barang" required>

          <select id="barangKategori" class="form-select mb-2" required>
            <option disabled selected>Pilih Kategori</option>
            <option>Peralatan Elektronik</option>
            <option>Peralatan Hobi</option>
            <option>Aksesoris Pendukung</option>
            <option>Peralatan Teknologi</option>
            <option>Peralatan Event</option>
            <option>Lainnya</option>
          </select>

          <textarea id="barangDeskripsi" class="form-control mb-2" rows="3" placeholder="Deskripsi"></textarea>

          <select id="barangKondisi" class="form-select mb-2">
            <option>Baru</option><option>Sangat Baik</option><option>Baik</option><option>Layak</option>
          </select>

          <textarea id="barangAturan" class="form-control mb-2" rows="2" placeholder="Aturan penggunaan"></textarea>

          <hr>
          <h6 class="fw-bold">3. Harga & Stok</h6>

          <input id="barangHarga" type="number" class="form-control mb-2" placeholder="Harga per Hari" required>
          <input id="barangDeposit" type="number" class="form-control mb-2" placeholder="Deposit (opsional)">
          <input id="barangStok" type="number" class="form-control mb-2" placeholder="Stok Barang" required>

          <hr>
          <h6 class="fw-bold">4. Foto Barang</h6>
          <input id="barangFoto" type="file" class="form-control mb-3" multiple accept="image/*" required>

          <hr>
          <h6 class="fw-bold">5. Lokasi Pengambilan</h6>
          <input id="barangLokasi" class="form-control mb-2" placeholder="Lokasi Penjemputan" required>
          <textarea id="barangCatatan" class="form-control mb-3" rows="2" placeholder="Catatan"></textarea>

          <button class="btn btn-success w-100">Tambah Barang</button>

        </form>
      </div>

    </div>
  </div>
</div>


<!-- ======================= CATEGORY ======================= -->
<section id="category" style="padding:80px; background:#BE9FE1;">
    <div class="container text-center">
        <h2 class="fw-bold mb-4">Kategori Barang</h2>

        <div class="row g-3">

            <div class="col-6 col-md-4 col-lg-2">
                <div class="card p-3 shadow-sm h-100" onclick="openCategory('Peralatan Elektronik')">
                    <img src="assets/Peralatan Elektronik.jpg" class="category-image">
                    <h6 class="fw-bold">Peralatan Elektronik</h6>
                </div>
            </div>

            <div class="col-6 col-md-4 col-lg-2">
                <div class="card p-3 shadow-sm h-100" onclick="openCategory('Peralatan Hobi')">
                    <img src="assets/Hobi.jpg" class="category-image">
                    <h6 class="fw-bold">Peralatan Hobi</h6>
                </div>
            </div>

            <div class="col-6 col-md-4 col-lg-2">
                <div class="card p-3 shadow-sm h-100" onclick="openCategory('Aksesoris Pendukung')">
                    <img src="assets/Aksesoris.jpg" class="category-image">
                    <h6 class="fw-bold">Aksesoris Pendukung</h6>
                </div>
            </div>

            <div class="col-6 col-md-4 col-lg-2">
                <div class="card p-3 shadow-sm h-100" onclick="openCategory('Peralatan Teknologi')">
                    <img src="assets/Teknologi.png" class="category-image">
                    <h6 class="fw-bold">Peralatan Teknologi</h6>
                </div>
            </div>

            <div class="col-6 col-md-4 col-lg-2">
                <div class="card p-3 shadow-sm h-100" onclick="openCategory('Peralatan Event')">
                    <img src="assets/Event.jpg" class="category-image">
                    <h6 class="fw-bold">Peralatan Event</h6>
                </div>
            </div>

            <div class="col-6 col-md-4 col-lg-2">
                <div class="card p-3 shadow-sm h-100" onclick="openCategory('Lainnya')">
                    <img src="assets/Lainnya.jpg" class="category-image">
                    <h6 class="fw-bold">Lainnya</h6>
                </div>
            </div>

        </div>
    </div>
</section>


<!-- ======================= MODAL CATEGORY VIEW ======================= -->
<div class="modal fade" id="categoryModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 id="categoryTitle" class="fw-bold"></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row g-3" id="categoryItems"></div>
      </div>

    </div>
  </div>
</div>



<!-- ======================= SCRIPT FINAL ======================= -->
<script>
// ==========================================================
// BUTTONS
// ==========================================================
document.getElementById("rentBtn").onclick = () =>
    new bootstrap.Modal(document.getElementById("rentModal")).show();

document.getElementById("addBtn").onclick = () =>
    new bootstrap.Modal(document.getElementById("addModal")).show();


// ==========================================================
// ADD ITEM â€” FINAL CLEAN VERSION
// ==========================================================
document.getElementById("addForm").addEventListener("submit", function(e){
    e.preventDefault();

    const item = {
        id: "BRG-" + Date.now(),
        nama: barangNama.value,
        kategori: barangKategori.value,
        deskripsi: barangDeskripsi.value,
        kondisi: barangKondisi.value,
        aturan: barangAturan.value,
        harga: Number(barangHarga.value),
        deposit: Number(barangDeposit.value),
        stok: Number(barangStok.value),
        lokasi: barangLokasi.value,
        catatan: barangCatatan.value,
        foto: Array.from(barangFoto.files).map(f => URL.createObjectURL(f))
    };

    let categoryDB = JSON.parse(localStorage.getItem("categoryDB")) || {
        "Peralatan Elektronik": [],
        "Peralatan Hobi": [],
        "Aksesoris Pendukung": [],
        "Peralatan Teknologi": [],
        "Peralatan Event": [],
        "Lainnya": []
    };

    categoryDB[item.kategori].push(item);
    localStorage.setItem("categoryDB", JSON.stringify(categoryDB));

    let sellerItems = JSON.parse(localStorage.getItem("sellerItems")) || [];
    sellerItems.push(item);
    localStorage.setItem("sellerItems", JSON.stringify(sellerItems));

    alert("Barang berhasil ditambahkan!");
    bootstrap.Modal.getInstance(addModal).hide();
    addForm.reset();
});


// ==========================================================
// OPEN CATEGORY â€” FINAL CLEAN VERSION
// ==========================================================
function openCategory(categoryName) {
    const categoryModal = new bootstrap.Modal(document.getElementById("categoryModal"));
    const container = document.getElementById("categoryItems");
    document.getElementById("categoryTitle").innerText = categoryName;

    const categoryDB = JSON.parse(localStorage.getItem("categoryDB")) || {};
    const sellerItems = JSON.parse(localStorage.getItem("sellerItems")) || [];

    const items = categoryDB[categoryName] || [];
    container.innerHTML = "";

    if (items.length === 0) {
        container.innerHTML = `<p class="text-center text-muted">Belum ada barang di kategori ini.</p>`;
        categoryModal.show();
        return;
    }

    items.forEach(item => {
        // ambil versi data di sellerItems agar stok terbaru
        const official = sellerItems.find(s => s.id === item.id);

        let stok = official ? official.stok : item.stok;

        container.innerHTML += `
            <div class="col-md-4">
                <div class="card shadow-sm p-2 h-100">
                    <img src="${item.foto[0]}" class="card-img-top" style="height:150px; object-fit:cover;">
                    
                    <div class="card-body">
                        <h5 class="fw-bold">${item.nama}</h5>
                        <p class="small mb-1">${item.deskripsi || "-"}</p>
                        <p class="mb-1"><b>Harga:</b> Rp ${item.harga.toLocaleString()}</p>
                        <p class="mb-1"><b>Stok:</b> ${stok}</p>

                        <button class="btn btn-primary w-100 mt-2" 
                            ${stok === 0 ? "disabled" : ""}
                            onclick="openRentFromCategory('${item.id}')">
                            ${stok === 0 ? "Stok Habis" : "Sewa Sekarang"}
                        </button>
                    </div>
                </div>
            </div>
        `;
    });

    categoryModal.show();
}

// ==========================================================
// SAVE RENT TRANSACTION
// ==========================================================
rentForm.addEventListener("submit", function(e){
    e.preventDefault();

    const penyewa = rentForm.querySelector("input:nth-child(1)").value;
    const nrp = rentForm.querySelector("input:nth-child(2)").value;
    const kontak = rentForm.querySelector("input:nth-child(3)").value;

    const namaBarang = namaBarangRent.value;

    const items = JSON.parse(localStorage.getItem("sellerItems")) || [];
    const item = items.find(i => i.nama === namaBarang);

    if (!item) {
        alert("Barang tidak ditemukan!");
        return;
    }

    let history = JSON.parse(localStorage.getItem("rentalHistory")) || [];
    history.push({
        rentId: "RENT-" + Date.now(),
        itemId: item.id,
        penyewa, nrp, kontak,
        status: "Sedang Disewa"
    });

    localStorage.setItem("rentalHistory", JSON.stringify(history));

    alert("Penyewaan berhasil!");
    bootstrap.Modal.getInstance(rentModal).hide();
});
</script>
<script>
function openRentFromCategory(itemId) {
    const sellerItems = JSON.parse(localStorage.getItem("sellerItems")) || [];
    const item = sellerItems.find(i => i.id === itemId);

    if (!item) {
        alert("Barang tidak ditemukan!");
        return;
    }

    // isi otomatis nama barang di rent modal
    const inputNama = document.getElementById("namaBarangRent");
    if (inputNama) inputNama.value = item.nama;

    // tampilkan modal sewa
    const rentModal = new bootstrap.Modal(document.getElementById("rentModal"));
    rentModal.show();
}
</script>

<!-- bootstrap js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>

