<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Seller View - Sewakuy</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background:#F7F7FB; }
        .card img { height:140px; object-fit:cover; }
    </style>
</head>

<body>

<!-- ======================= NAVBAR ======================= -->
<nav class="navbar navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold">Seller Panel</a>
    <a href="index.html" class="btn btn-secondary">Kembali ke Home</a>
  </div>
</nav>


<div class="container py-4">

    <!-- ======================= HEADER ======================= -->
    <h2 class="fw-bold mb-4">ðŸ“¦ Dashboard Seller</h2>


    <!-- ======================= TAB MENU ======================= -->
    <ul class="nav nav-tabs mb-4" id="sellerTabs">
      <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#items">Barang Terdaftar</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#rentHistory">Riwayat Penyewaan</a>
      </li>
    </ul>


    <div class="tab-content">

        <!-- ===========================================================
             TAB 1 â€” BARANG TERDAFTAR
        ============================================================ -->
        <div class="tab-pane fade show active" id="items">

            <div class="row g-3" id="sellerItemList"></div>

        </div>


        <!-- ===========================================================
             TAB 2 â€” RIWAYAT PENYEWAAN
        ============================================================ -->
        <div class="tab-pane fade" id="rentHistory">

            <div id="rentalHistoryList"></div>

        </div>

    </div>

</div>


<!-- ======================= SCRIPT ======================= -->
<script>
// ==========================================================
// LOAD SELLER ITEMS
// ==========================================================
function loadSellerItems() {
    let items = JSON.parse(localStorage.getItem("sellerItems")) || [];
    const container = document.getElementById("sellerItemList");

    container.innerHTML = "";

    if (items.length === 0) {
        container.innerHTML = `<p class="text-muted text-center">Belum ada barang yang terdaftar.</p>`;
        return;
    }

    items.forEach(item => {
        container.innerHTML += `
            <div class="col-md-4">
                <div class="card p-2 shadow-sm h-100">
                    <img src="${item.foto[0]}" class="card-img-top">
                    <div class="card-body">
                        <h5 class="fw-bold">${item.nama}</h5>
                        <p><b>Kategori:</b> ${item.kategori}</p>
                        <p><b>Harga:</b> Rp ${item.harga.toLocaleString()}</p>
                        <p><b>Stok:</b> ${item.stok}</p>

                        <div class="d-flex gap-2 mt-3">
                            <button class="btn btn-warning btn-sm" onclick="editItem('${item.id}')">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')">Hapus</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
}



// ==========================================================
// EDIT ITEM
// ==========================================================
function editItem(id) {
    let items = JSON.parse(localStorage.getItem("sellerItems")) || [];
    let item = items.find(i => i.id === id);

    if (!item) return alert("Barang tidak ditemukan!");

    let newNama = prompt("Nama baru:", item.nama);
    if (!newNama) return;

    let newHarga = prompt("Harga baru:", item.harga);
    let newStok = prompt("Stok baru:", item.stok);

    item.nama = newNama;
    item.harga = Number(newHarga);
    item.stok = Number(newStok);

    // simpan kembali
    localStorage.setItem("sellerItems", JSON.stringify(items));

    // update di categoryDB
    let categoryDB = JSON.parse(localStorage.getItem("categoryDB")) || {};
    for (let cat in categoryDB) {
        categoryDB[cat] = categoryDB[cat].map(c => c.id === id ? item : c);
    }

    localStorage.setItem("categoryDB", JSON.stringify(categoryDB));

    alert("Barang berhasil diperbarui.");
    loadSellerItems();
}



// ==========================================================
// DELETE ITEM
// ==========================================================
function deleteItem(id) {
    if (!confirm("Yakin ingin menghapus barang ini?")) return;

    let items = JSON.parse(localStorage.getItem("sellerItems")) || [];
    let newItems = items.filter(i => i.id !== id);
    localStorage.setItem("sellerItems", JSON.stringify(newItems));

    // hapus dari kategori
    let categoryDB = JSON.parse(localStorage.getItem("categoryDB")) || {};
    for (let cat in categoryDB) {
        categoryDB[cat] = categoryDB[cat].filter(i => i.id !== id);
    }
    localStorage.setItem("categoryDB", JSON.stringify(categoryDB));

    // hapus dari rental history
    let history = JSON.parse(localStorage.getItem("rentalHistory")) || [];
    history = history.filter(h => h.itemId !== id);
    localStorage.setItem("rentalHistory", JSON.stringify(history));

    alert("Barang berhasil dihapus.");
    loadSellerItems();
    loadRentHistory();
}



// ==========================================================
// LOAD RENTAL HISTORY
// ==========================================================
function loadRentHistory() {
    let rentals = JSON.parse(localStorage.getItem("rentalHistory")) || [];
    let items = JSON.parse(localStorage.getItem("sellerItems")) || [];

    const wrap = document.getElementById("rentalHistoryList");
    wrap.innerHTML = "";

    if (rentals.length === 0) {
        wrap.innerHTML = `<p class="text-muted text-center">Belum ada transaksi penyewaan.</p>`;
        return;
    }

    rentals.forEach(r => {
        let barang = items.find(i => i.id === r.itemId);

        wrap.innerHTML += `
            <div class="card p-3 mb-3 shadow-sm">
                <div class="row">
                    <div class="col-md-3">
                        <img src="${barang?.foto[0] || ''}" class="w-100 rounded">
                    </div>
                    <div class="col-md-9">
                        <h5 class="fw-bold">${barang?.nama ?? "Barang dihapus"}</h5>

                        <p><b>Penyewa:</b> ${r.penyewa}</p>
                        <p><b>NRP:</b> ${r.nrp}</p>
                        <p><b>Kontak:</b> ${r.kontak}</p>

                        <p><b>Status:</b> 
                            <span class="badge ${r.status === "Dikembalikan" ? "bg-success" : "bg-warning text-dark"}">
                                ${r.status}
                            </span>
                        </p>

                        ${r.status === "Sedang Disewa" ? `
                            <button class="btn btn-success btn-sm" onclick="returnItem('${r.rentId}')">
                                Tandai Dikembalikan
                            </button>
                        ` : ``}
                    </div>
                </div>
            </div>
        `;
    });
}



// ==========================================================
// RETURN ITEM (Update Status)
// ==========================================================
function returnItem(rentId) {
    let rentals = JSON.parse(localStorage.getItem("rentalHistory")) || [];
    let items = JSON.parse(localStorage.getItem("sellerItems")) || [];

    let rent = rentals.find(r => r.rentId === rentId);
    let item = items.find(i => i.id === rent.itemId);

    rent.status = "Dikembalikan";
    item.stok += 1;

    localStorage.setItem("rentalHistory", JSON.stringify(rentals));
    localStorage.setItem("sellerItems", JSON.stringify(items));

    alert("Barang berhasil ditandai sebagai dikembalikan!");
    loadRentHistory();
    loadSellerItems();
}



// ==========================================================
// INITIAL LOAD
// ==========================================================
loadSellerItems();
loadRentHistory();
</script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
